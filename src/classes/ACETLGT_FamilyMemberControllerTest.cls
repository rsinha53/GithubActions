@isTest
public class ACETLGT_FamilyMemberControllerTest {
  @IsTest
    Public static void LightningFamilyMembersMethod()
    {
        User thisUser = [Select Id From User Where Id =:UserInfo.getUserId()];
        User memberAgent;
         System.runAs(thisUser){
         memberAgent = TestDataFactory.getUser('ACET Member'); 
         Map<String, String> mapISLWSConfigs = new Map<String, String>(); 
            mapISLWSConfigs.put('ISLConAccessToken', 'e9b3f2b1-8863-49ec-9ff8-40da25961ef5');
            mapISLWSConfigs.put('OILHttpHeaderAccept', 'application/json;charset=UTF-8');
            mapISLWSConfigs.put('OILHttpHeaderActor', 'ACET');
            mapISLWSConfigs.put('OILHttpHeaderScope', 'read');
            mapISLWSConfigs.put('ISLOAuthContentType', 'application/x-www-form-urlencoded');
            mapISLWSConfigs.put('ISLOAuthGrantType', 'client_credentials');
            mapISLWSConfigs.put('dev_ISLOAuthClientId', 'ISLStageConClientId');
            mapISLWSConfigs.put('dev_ISLOAuthClientSecret', 'ISLStageConClientSecret');
            mapISLWSConfigs.put('dev_ISLOAuthEndpoint', 'https://api-stg.optum.com:8443');
             mapISLWSConfigs.put('dev_GetFamilyMembersEndpoint', '/api/alpha/eisl/individuals/familymembership/v2.0/read');           
            mapISLWSConfigs.put('OILTimeout', '3000'); 
           
        List<ISL_Webservice_Config__c> lstISLWSConfigs = ACETTestDataUtility.CreateISLWebserviceConfigurations(mapISLWSConfigs);
       //Setting relationship codes        
        list<ACETRelationshipCodes__c> rCodes = new list<ACETRelationshipCodes__c> ();
        rCodes.add(new ACETRelationshipCodes__c (Name = '18',Description__c = 'Self'));
        rCodes.add(new ACETRelationshipCodes__c (Name = '01',Description__c = 'Spouse'));
        rCodes.add(new ACETRelationshipCodes__c (Name = '19',Description__c = 'Child'));
        insert rCodes;      
        
           MockHttpCalloutResponseGenerator.MockHttpResponse OILResponse = new MockHttpCalloutResponseGenerator.MockHttpResponse(200, 'OK', '{"getFamilyMembershipResponse":{"individual":[{"individualIdentifier":"492265628","name":{"firstName":"MACKENZIE","lastName":"ONORATI","middleName":"","nameSuffix":""},"birthDate":"2012-04-12","genderCode":"M","genderDescription":"Male","socialSecurityNumber":"802876040","privacyIndicator":"N","address":[{"typeCode":"HOM","addressLine1":"4083 56TH AVE NE","addressLine2":"","city":"STAMFORD","postalCode":"06922","stateCode":"CT","countryCode":"US"}],"dependentDisabilityList":[{}],"membership":[{"sourceSysCode":"CR","coverages":[{"groupNumber":"1168520","groupName":"GRAHAM CAPITAL MANAGEMENT LP","eligibilitySystemTypeCode":"CR","claimSystemTypeCode":"CR","memberStatus":"ACTIVE","bundleOptions":[{"benefits":[{"benefitBundleOptionId":"1738484","benefitBundleOptionDescription":"","benefitEffectiveDate":"2018-10-01","benefitExpirationDate":"9999-12-31","benefitPlanId":"MNS0000003","benefitPlanName":"Graham Cap Mgt - KACTOHP61R - NON-63055","benefitType":"MD","coverageLevelCode":"FAM","product":{"productIdentifier":"PM00000006"},"relationshipCode":"19","relationshipDescription":"Child","memberIdCardSerialNumber":"97161070003","subscriberIdCardSerialNumber":"97161070000","eligibilityStatusCode":"A","cancelReasonTypeCode":"","memberDirectBillingInd":"false","linkedSubscriberId":"","planType":"06","networkScheduleID":"FREEDOM_CHOICEPLUS","coverageLevelList":[{"covLevelCode":"FAM","covLevelDesc":"Family","covLevelEffDate":"2018-10-01","covLevelExpDate":"9999-12-31"}],"holdList":[{}],"indicators":{"qmscoIndicator":"N","hsaIndicator":"Y"}},{"benefitBundleOptionId":"1738484","benefitBundleOptionDescription":"","benefitEffectiveDate":"2018-10-01","benefitExpirationDate":"9999-12-31","benefitPlanId":"RX00000037","benefitPlanName":"LG $5/$25/$40","benefitType":"RX","coverageLevelCode":"FAM","product":{"productIdentifier":"PM00000006"},"relationshipCode":"19","relationshipDescription":"Child","memberIdCardSerialNumber":"97161070003","subscriberIdCardSerialNumber":"97161070000","eligibilityStatusCode":"A","cancelReasonTypeCode":"","memberDirectBillingInd":"false","linkedSubscriberId":"","planType":"03","coverageLevelList":[{"covLevelCode":"FAM","covLevelDesc":"Family","covLevelEffDate":"2018-10-01","covLevelExpDate":"9999-12-31"}],"holdList":[{}],"indicators":{"qmscoIndicator":"N","hsaIndicator":"N"}}]}]}],"cob":[{}],"providers":[{}],"identifiers":[{"id":"492265628","type":"enrolleeEID"},{"id":"100000031216","type":"subscriberSystemId"},{"id":"100000031242","type":"enrolleeSystemID"},{"id":"654651892","type":"subscriberSurrogateKey"},{"id":"654651883","type":"enrolleeSurrogateKey"}]}]},{"individualIdentifier":"492293043","name":{"firstName":"TRANG","lastName":"ONORATI","middleName":"","nameSuffix":""},"birthDate":"2013-10-15","genderCode":"F","genderDescription":"Female","socialSecurityNumber":"314975443","privacyIndicator":"N","address":[{"typeCode":"HOM","addressLine1":"4083 56TH AVE NE","addressLine2":"","city":"STAMFORD","postalCode":"06922","stateCode":"CT","countryCode":"US"}],"dependentDisabilityList":[{}],"membership":[{"sourceSysCode":"CR","coverages":[{"groupNumber":"1168520","groupName":"GRAHAM CAPITAL MANAGEMENT LP","eligibilitySystemTypeCode":"CR","claimSystemTypeCode":"CR","memberStatus":"ACTIVE","bundleOptions":[{"benefits":[{"benefitBundleOptionId":"1738484","benefitBundleOptionDescription":"","benefitEffectiveDate":"2018-10-01","benefitExpirationDate":"9999-12-31","benefitPlanId":"MNS0000003","benefitPlanName":"Graham Cap Mgt - KACTOHP61R - NON-63055","benefitType":"MD","coverageLevelCode":"FAM","product":{"productIdentifier":"PM00000006"},"relationshipCode":"19","relationshipDescription":"Child","memberIdCardSerialNumber":"97161070004","subscriberIdCardSerialNumber":"97161070000","eligibilityStatusCode":"A","cancelReasonTypeCode":"","memberDirectBillingInd":"false","linkedSubscriberId":"","planType":"06","networkScheduleID":"FREEDOM_CHOICEPLUS","coverageLevelList":[{"covLevelCode":"FAM","covLevelDesc":"Family","covLevelEffDate":"2018-10-01","covLevelExpDate":"9999-12-31"}],"holdList":[{}],"indicators":{"qmscoIndicator":"N","hsaIndicator":"Y"}},{"benefitBundleOptionId":"1738484","benefitBundleOptionDescription":"","benefitEffectiveDate":"2018-10-01","benefitExpirationDate":"9999-12-31","benefitPlanId":"RX00000037","benefitPlanName":"LG $5/$25/$40","benefitType":"RX","coverageLevelCode":"FAM","product":{"productIdentifier":"PM00000006"},"relationshipCode":"19","relationshipDescription":"Child","memberIdCardSerialNumber":"97161070004","subscriberIdCardSerialNumber":"97161070000","eligibilityStatusCode":"A","cancelReasonTypeCode":"","memberDirectBillingInd":"false","linkedSubscriberId":"","planType":"03","coverageLevelList":[{"covLevelCode":"FAM","covLevelDesc":"Family","covLevelEffDate":"2018-10-01","covLevelExpDate":"9999-12-31"}],"holdList":[{}],"indicators":{"qmscoIndicator":"N","hsaIndicator":"N"}}]}]}],"cob":[{}],"providers":[{}],"identifiers":[{"id":"492293043","type":"enrolleeEID"},{"id":"100000031216","type":"subscriberSystemId"},{"id":"100000031245","type":"enrolleeSystemID"},{"id":"654651892","type":"subscriberSurrogateKey"},{"id":"654679255","type":"enrolleeSurrogateKey"}]}]},{"individualIdentifier":"492280979","name":{"firstName":"TAMA","lastName":"ONORATI","middleName":"","nameSuffix":""},"birthDate":"1977-02-24","genderCode":"M","genderDescription":"Male","socialSecurityNumber":"","privacyIndicator":"N","address":[{"typeCode":"HOM","addressLine1":"4083 56TH AVE NE","addressLine2":"","city":"STAMFORD","postalCode":"06922","stateCode":"CT","countryCode":"US"}],"dependentDisabilityList":[{}],"membership":[{"sourceSysCode":"CR","coverages":[{"groupNumber":"1168520","groupName":"GRAHAM CAPITAL MANAGEMENT LP","eligibilitySystemTypeCode":"CR","claimSystemTypeCode":"CR","memberStatus":"ACTIVE","bundleOptions":[{"benefits":[{"benefitBundleOptionId":"1738484","benefitBundleOptionDescription":"","benefitEffectiveDate":"2018-10-01","benefitExpirationDate":"9999-12-31","benefitPlanId":"MNS0000003","benefitPlanName":"Graham Cap Mgt - KACTOHP61R - NON-63055","benefitType":"MD","coverageLevelCode":"FAM","product":{"productIdentifier":"PM00000006"},"relationshipCode":"01","relationshipDescription":"Spouse","memberIdCardSerialNumber":"97161070001","subscriberIdCardSerialNumber":"97161070000","eligibilityStatusCode":"A","cancelReasonTypeCode":"","memberDirectBillingInd":"false","linkedSubscriberId":"","planType":"06","networkScheduleID":"FREEDOM_CHOICEPLUS","coverageLevelList":[{"covLevelCode":"FAM","covLevelDesc":"Family","covLevelEffDate":"2018-10-01","covLevelExpDate":"9999-12-31"}],"holdList":[{}],"indicators":{"qmscoIndicator":"N","hsaIndicator":"Y"}},{"benefitBundleOptionId":"1738484","benefitBundleOptionDescription":"","benefitEffectiveDate":"2018-10-01","benefitExpirationDate":"9999-12-31","benefitPlanId":"RX00000037","benefitPlanName":"LG $5/$25/$40","benefitType":"RX","coverageLevelCode":"FAM","product":{"productIdentifier":"PM00000006"},"relationshipCode":"01","relationshipDescription":"Spouse","memberIdCardSerialNumber":"97161070001","subscriberIdCardSerialNumber":"97161070000","eligibilityStatusCode":"A","cancelReasonTypeCode":"","memberDirectBillingInd":"false","linkedSubscriberId":"","planType":"03","coverageLevelList":[{"covLevelCode":"FAM","covLevelDesc":"Family","covLevelEffDate":"2018-10-01","covLevelExpDate":"9999-12-31"}],"holdList":[{}],"indicators":{"qmscoIndicator":"N","hsaIndicator":"N"}}]}]}],"cob":[{}],"providers":[{}],"identifiers":[{"id":"492280979","type":"enrolleeEID"},{"id":"100000031216","type":"subscriberSystemId"},{"id":"100000031231","type":"enrolleeSystemID"},{"id":"654651892","type":"subscriberSurrogateKey"},{"id":"654667179","type":"enrolleeSurrogateKey"}]}]},{"individualIdentifier":"492265644","name":{"firstName":"SOILA","lastName":"ONORATI","middleName":"","nameSuffix":""},"birthDate":"2011-02-01","genderCode":"M","genderDescription":"Male","socialSecurityNumber":"047171607","privacyIndicator":"N","address":[{"typeCode":"HOM","addressLine1":"4083 56TH AVE NE","addressLine2":"","city":"STAMFORD","postalCode":"06922","stateCode":"CT","countryCode":"US"}],"dependentDisabilityList":[{}],"membership":[{"sourceSysCode":"CR","coverages":[{"groupNumber":"1168520","groupName":"GRAHAM CAPITAL MANAGEMENT LP","eligibilitySystemTypeCode":"CR","claimSystemTypeCode":"CR","memberStatus":"ACTIVE","bundleOptions":[{"benefits":[{"benefitBundleOptionId":"1738484","benefitBundleOptionDescription":"","benefitEffectiveDate":"2018-10-01","benefitExpirationDate":"9999-12-31","benefitPlanId":"MNS0000003","benefitPlanName":"Graham Cap Mgt - KACTOHP61R - NON-63055","benefitType":"MD","coverageLevelCode":"FAM","product":{"productIdentifier":"PM00000006"},"relationshipCode":"19","relationshipDescription":"Child","memberIdCardSerialNumber":"97161070002","subscriberIdCardSerialNumber":"97161070000","eligibilityStatusCode":"A","cancelReasonTypeCode":"","memberDirectBillingInd":"false","linkedSubscriberId":"","planType":"06","networkScheduleID":"FREEDOM_CHOICEPLUS","coverageLevelList":[{"covLevelCode":"FAM","covLevelDesc":"Family","covLevelEffDate":"2018-10-01","covLevelExpDate":"9999-12-31"}],"holdList":[{}],"indicators":{"qmscoIndicator":"N","hsaIndicator":"Y"}},{"benefitBundleOptionId":"1738484","benefitBundleOptionDescription":"","benefitEffectiveDate":"2018-10-01","benefitExpirationDate":"9999-12-31","benefitPlanId":"RX00000037","benefitPlanName":"LG $5/$25/$40","benefitType":"RX","coverageLevelCode":"FAM","product":{"productIdentifier":"PM00000006"},"relationshipCode":"19","relationshipDescription":"Child","memberIdCardSerialNumber":"97161070002","subscriberIdCardSerialNumber":"97161070000","eligibilityStatusCode":"A","cancelReasonTypeCode":"","memberDirectBillingInd":"false","linkedSubscriberId":"","planType":"03","coverageLevelList":[{"covLevelCode":"FAM","covLevelDesc":"Family","covLevelEffDate":"2018-10-01","covLevelExpDate":"9999-12-31"}],"holdList":[{}],"indicators":{"qmscoIndicator":"N","hsaIndicator":"N"}}]}]}],"cob":[{}],"providers":[{}],"identifiers":[{"id":"492265644","type":"enrolleeEID"},{"id":"100000031216","type":"subscriberSystemId"},{"id":"100000031236","type":"enrolleeSystemID"},{"id":"654651892","type":"subscriberSurrogateKey"},{"id":"654651860","type":"enrolleeSurrogateKey"}]}]},{"individualIdentifier":"492265646","name":{"firstName":"LORINA","lastName":"ONORATI","middleName":"","nameSuffix":""},"birthDate":"1979-08-27","genderCode":"F","genderDescription":"Female","socialSecurityNumber":"056628382","privacyIndicator":"N","address":[{"typeCode":"HOM","addressLine1":"4083 56TH AVE NE","addressLine2":"","city":"STAMFORD","postalCode":"06922","stateCode":"CT","countryCode":"US"}],"dependentDisabilityList":[{}],"membership":[{"sourceSysCode":"CR","coverages":[{"groupNumber":"1168520","groupName":"GRAHAM CAPITAL MANAGEMENT LP","eligibilitySystemTypeCode":"CR","claimSystemTypeCode":"CR","memberStatus":"ACTIVE","bundleOptions":[{"benefits":[{"benefitBundleOptionId":"1738484","benefitBundleOptionDescription":"","benefitEffectiveDate":"2018-10-01","benefitExpirationDate":"9999-12-31","benefitPlanId":"MNS0000003","benefitPlanName":"Graham Cap Mgt - KACTOHP61R - NON-63055","benefitType":"MD","coverageLevelCode":"FAM","product":{"productIdentifier":"PM00000006"},"relationshipCode":"18","relationshipDescription":"Self","memberIdCardSerialNumber":"97161070000","subscriberIdCardSerialNumber":"97161070000","eligibilityStatusCode":"A","cancelReasonTypeCode":"","memberDirectBillingInd":"false","linkedSubscriberId":"","planType":"06","networkScheduleID":"FREEDOM_CHOICEPLUS","coverageLevelList":[{"covLevelCode":"FAM","covLevelDesc":"Family","covLevelEffDate":"2018-10-01","covLevelExpDate":"9999-12-31"}],"holdList":[{}],"indicators":{"qmscoIndicator":"N","hsaIndicator":"Y"}},{"benefitBundleOptionId":"1738484","benefitBundleOptionDescription":"","benefitEffectiveDate":"2018-10-01","benefitExpirationDate":"9999-12-31","benefitPlanId":"RX00000037","benefitPlanName":"LG $5/$25/$40","benefitType":"RX","coverageLevelCode":"FAM","product":{"productIdentifier":"PM00000006"},"relationshipCode":"18","relationshipDescription":"Self","memberIdCardSerialNumber":"97161070000","subscriberIdCardSerialNumber":"97161070000","eligibilityStatusCode":"A","cancelReasonTypeCode":"","memberDirectBillingInd":"false","linkedSubscriberId":"","planType":"03","coverageLevelList":[{"covLevelCode":"FAM","covLevelDesc":"Family","covLevelEffDate":"2018-10-01","covLevelExpDate":"9999-12-31"}],"holdList":[{}],"indicators":{"qmscoIndicator":"N","hsaIndicator":"N"}}]}]}],"cob":[{}],"providers":[{"providerIdentifiers":[{"id":"P4152441","type":"PUL"},{"id":"D400002428","type":"1C"},{"id":"D400054474","type":"1C"},{"id":"832901320","type":"SSN"},{"id":"1441688","type":"MPI"},{"id":"P4416275","type":"PUL"},{"id":"1669542999","type":"NPI"},{"id":"831446190354151913","type":"LTK"}],"assignmentType":"OBGYN","effectiveDate":"2018-10-01","expirationDate":"9999-12-31","firstName":"CAROL","lastName":"FUCIGNA","networkId":"7","organizationLocationId":"0","locationAffiliationId":"39421107","address1":"1351 WASHINGTON BLVD","address2":"","address3":"","address4":"","address5":"","city":"STAMFORD","state":"CT","postalCode":"06902-2419","country":"US"},{"providerIdentifiers":[{"id":"603408","type":"1C"},{"id":"494146193657144226","type":"LTK"},{"id":"1457350522","type":"NPI"},{"id":"1260481","type":"MPI"},{"id":"P5517882","type":"PUL"},{"id":"750922259","type":"SSN"}],"assignmentType":"PCP","effectiveDate":"2019-09-06","expirationDate":"9999-12-31","firstName":"TODD","lastName":"AARON","networkId":"7","organizationLocationId":"0","locationAffiliationId":"37312757","address1":"850 PAPER MILL RD","address2":"","address3":"","address4":"","address5":"","city":"GLENSIDE","state":"PA","postalCode":"19038-7833","country":"US"}],"identifiers":[{"id":"492265646","type":"enrolleeEID"},{"id":"100000031216","type":"subscriberSystemId"},{"id":"100000031216","type":"enrolleeSystemID"},{"id":"654651892","type":"subscriberSurrogateKey"},{"id":"654651892","type":"enrolleeSurrogateKey"}]}]}]}}');
        OILResponse.TokenExpired = false;        
        MockHttpCalloutResponseGenerator MockHttpRes = new MockHttpCalloutResponseGenerator(null, OILResponse);
        Test.setMock(HttpCalloutMock.class, MockHttpRes);
                        }
           System.runAs(memberAgent){
            Test.startTest();
                ACETLGT_FamilyMemberController fammem= new ACETLGT_FamilyMemberController(); 
       
            ACETLGT_FamilyMemberController.getFamilyMembershipResults('654651892','654651892','1168520','10/1/2018','10/1/2018','MNS0000003', '12345678901');
            Test.stopTest();
            
        }
        
    }
    
}