@isTest
public class ADBLoyaltyControllerTest {
    @testSetup static void setup() {
        Test.startTest();
        List<WebserviceConfigurations__c> configs = new List<WebserviceConfigurations__c>{
            new WebserviceConfigurations__c(Name = 'ADBLoyaltyEndpoint',recordtypeText__c = 'Token_API', Method__c = 'POST', Timeout__c = 10000)
                };
                    insert configs;
        
        List<OrgSpecificConfigurations__c> orgConfigs = new List<OrgSpecificConfigurations__c>{
            new OrgSpecificConfigurations__c(WebserviceConfigurations__c = configs[0].Id,recordtypeText__c = 'TokenAPI', Name = 'QA', EndpointDomain__c = 'https://gateway-stage.optum.com')
                };
                    insert orgConfigs;
        
        Organization_Properties__c property = new Organization_Properties__c(OrganizationName__c = 'QA');
        insert property;
        Test.stopTest();
    }
    @isTest static void getLoyaltyDetails(){
        String memberId = '567353078';
        String policyNumber = '0743634';
        String asofDate = '2020-05-04';
        test.startTest();
        StaticResourceCalloutMock mock = new StaticResourceCalloutMock();
        mock.setStaticResource('ACETLoyaltyMockResponse');
        mock.setStatusCode(200);
        // Set the mock callout mode
        Test.setMock(HttpCalloutMock.class, mock);
        ADBLoyaltyController.getLoyaltyDetails(memberId,policyNumber,asofDate);
        test.stopTest();  
    }
    
    @isTest static void  testADBLoyaltyResponseWrapper(){
        test.startTest();
        String val = '{ "readResult": { "readOutput": { "eligibilities": [{ "subscriberId": "00916036403", "alternateId": "923654329", "subscriberDetail": { "eligibility": { "consumerKeys": { "sourceCode": "CS", "familyId": "0012762421", "familyIdPartitionNumber": "00121", "xrefId": "0022658919", "xrefIdPartitionNumber": "00019", "legacySourceId": "09115850091603640300001" }, "demographics": { "personName": { "firstName": "PRINCE", "middleInitial": "G", "middleName": "G", "lastName": "ROBINSON", "nameSuffix": "" }, "topsName": "PRINCE", "gender": "M", "age": "45", "dependentNumber": "001", "topsLatestCancelDate": "", "systemDivision": "", "tobaccoUsageIndicator": "", "memberId": "", "survivingSpouseId": "", "hicNumber": "", "medicaidRecipientNumber": "", "memberAltId": "", "socialSecurityNumber": "916036403", "legacyPolicyNumber": "0911585", "claimEngineCode": "X", "legacyCustomerNumber": "0911585", "cesCustomerName": "SALESFORCE", "differentFamilyMemberAddressIndicator": "Y", "alternateIdAssignTypeCode": "S", "marketSegment": "USS", "integratedCardTypeCode": "H", "employeeStartDate": "2018-01-01", "workHours": "00000", "salaryTypeCode": "", "salaryAmount": "0.00", "retirementDate": "9999-12-31", "deceasedDate": "9999-12-31", "lateEnrollCode": "", "exSpouseTypeCode": "", "exSpouseSubscriberId": "", "healthCoverageTransferIndicator": "", "healthCoverageTransferEffectiveDates": { "start": "0001-01-01", "end": "9999-12-31" }, "atOccupationTypeCode": "", "rrDependentProofOfEligibilityDate": "", "cobraIndicator": "", "cobIndicator": "", "cobVerifyDate": "", "cobEffectiveDates": { "start": "", "end": "" }, "medicareExistsIndicator": "", "medicareTypeCode": "", "medicareIneligibleNotEnrolledCode": "", "medicareEntitlementTypeCode": "", "custodyCode": "", "familyLastUpdateTimestamp": "2018-08-27-10.35.20.150835", "migrationLegacySourceId": "", "migrationLegacyPolicyNumber": "", "camsLegacySourceId": "", "camsLegacyPolicyNumber": "", "consumerProvidedTaxIdNumber": "", "consumerProvidedTaxIdNumberStatusTypeCd": "", "eobSuppressionIndicator": "", "healthStatementSuppressionIndicator": "", "administrativeLetterSuppressionIndicator": "", "proofOfHealthCoverageSuppressionIndicator": "", "preferenceCodeDescription": "No preference selected", "memberLoyaltyYearsOfService": "", "memberLoyaltyAcknowledgementDate": "", "reportSegment": "USS", "healthProgramCode": "", "healthPlanCode": "", "familyId": "0012762421", "familyIdPartitionNumber": "00121", "sourceCode": "CS", "priorMemberId": "PMI", "dateOfBirth": "1975-04-01", "cdbRelationshipCode": "000", "legacySourceRelationshipCode": "00", "individualRelationshipCode": "EE", "topsSequenceNumber": "00", "topsOrigCoverageEffectiveDate": "2018-02-08", "primeDependentCode": "", "maritalStatus": "M", "employeeStatus": "A", "specialHandlerCode": "0", "phiIndicator": "", "qmscoIndicator": "", "primaryPhoneNumber": "", "alternatePhoneNumber": "", "mobilePhoneNumber": "", "organizationTypeCode": "", "permanentAddress": { "postalAddress": { "street1": "UHC MKT#1", "street2": "", "street3": "", "city": "MINNESOTA SOUTHERN", "state": "MN", "zip": "55001", "zip4": "", "countryCode": "US" }, "marketNumber": "0022700", "countrySubCode": "" }, "mailingAddress": { "postalAddress": { "street1": "UHC MKT#1", "street2": "", "street3": "", "city": "MINNESOTA SOUTHERN", "state": "MN", "zip": "55001", "zip4": "", "countryCode": "US" }, "marketNumber": "0022700", "countrySubCode": "" } }, "eligibilityDetailHealthServices": [{ "policyNumber": "0911585", "productLine": "G", "productCode": "IW", "healthServiceEffectiveDates": { "start": "2018-02-08", "end": "9999-12-31" }, "cesGroupNumber": "0911585", "planVariationCode": "0001", "reportingCode": "0001", "systemDivision": "", "passportGroupNumber": "", "coverageLevel": "7", "sharedArrangementCode": "03", "obligorId": "01", "eligibilityStatusTypeCode": "A", "eligibilitySystemTypeCode": "01", "cancelReasonTypeCode": "", "coveragePaidThruDate": "9999-12-31", "coveragePaidThruReasonCode": "", "listBillTypeCode": "N", "billingSuffixCode": "P", "billingSubGroupNumber": "01001", "fundingType": "A", "stateOfIssue": "CA", "legacyBenefitPlanId": "", "legacyProductId": "", "consumerLegalEntity": "", "individualGroupTypeCode": "", "billIndicatorTypeCode": "" } ] } }, "dependents": [{ "eligibility": { "consumerKeys": { "sourceCode": "CS", "familyId": "0012762421", "familyIdPartitionNumber": "00121", "xrefId": "0022658926", "xrefIdPartitionNumber": "00006", "legacySourceId": "09115850091603640301001" }, "demographics": { "personName": { "firstName": "HOPE", "middleInitial": "", "middleName": "", "lastName": "ROBINSON", "nameSuffix": "" }, "topsName": "HOPE", "gender": "F", "age": "40", "dependentNumber": "001", "topsLatestCancelDate": "", "systemDivision": "", "tobaccoUsageIndicator": "", "memberId": "", "survivingSpouseId": "", "hicNumber": "", "medicaidRecipientNumber": "", "memberAltId": "", "socialSecurityNumber": "000000000", "legacyPolicyNumber": "0911585", "claimEngineCode": "X", "legacyCustomerNumber": "0911585", "cesCustomerName": "SALESFORCE", "differentFamilyMemberAddressIndicator": "Y", "alternateIdAssignTypeCode": "S", "marketSegment": "USS", "integratedCardTypeCode": "H", "employeeStartDate": "0001-01-01", "workHours": "00000", "salaryTypeCode": "", "salaryAmount": "0.00", "retirementDate": "9999-12-31", "deceasedDate": "9999-12-31", "lateEnrollCode": "", "exSpouseTypeCode": "", "exSpouseSubscriberId": "", "healthCoverageTransferIndicator": "", "healthCoverageTransferEffectiveDates": { "start": "0001-01-01", "end": "9999-12-31" }, "atOccupationTypeCode": "", "rrDependentProofOfEligibilityDate": "", "cobraIndicator": "", "cobIndicator": "", "cobVerifyDate": "", "cobEffectiveDates": { "start": "", "end": "" }, "medicareExistsIndicator": "", "medicareTypeCode": "", "medicareIneligibleNotEnrolledCode": "", "medicareEntitlementTypeCode": "", "custodyCode": "", "familyLastUpdateTimestamp": "2018-08-27-10.35.20.150835", "migrationLegacySourceId": "", "migrationLegacyPolicyNumber": "", "camsLegacySourceId": "", "camsLegacyPolicyNumber": "", "consumerProvidedTaxIdNumber": "", "consumerProvidedTaxIdNumberStatusTypeCd": "", "eobSuppressionIndicator": "", "healthStatementSuppressionIndicator": "", "administrativeLetterSuppressionIndicator": "", "proofOfHealthCoverageSuppressionIndicator": "", "preferenceCodeDescription": "No preference selected", "memberLoyaltyYearsOfService": "", "memberLoyaltyAcknowledgementDate": "", "reportSegment": "USS", "healthProgramCode": "", "healthPlanCode": "", "familyId": "0012762421", "familyIdPartitionNumber": "00121", "sourceCode": "CS", "priorMemberId": "PMI", "dateOfBirth": "1980-01-01", "cdbRelationshipCode": "001", "legacySourceRelationshipCode": "01", "individualRelationshipCode": "SP", "topsSequenceNumber": "01", "topsOrigCoverageEffectiveDate": "2018-02-08", "primeDependentCode": "", "maritalStatus": "M", "employeeStatus": "A", "specialHandlerCode": "0", "phiIndicator": "", "qmscoIndicator": "", "primaryPhoneNumber": "", "alternatePhoneNumber": "", "mobilePhoneNumber": "", "organizationTypeCode": "", "permanentAddress": { "postalAddress": { "street1": "UHC MKT#1", "street2": "", "street3": "", "city": "MINNESOTA SOUTHERN", "state": "MN", "zip": "55009", "zip4": "", "countryCode": "US" }, "marketNumber": "0022300", "countrySubCode": "" }, "mailingAddress": { "postalAddress": { "street1": "UHC MKT#1", "street2": "", "street3": "", "city": "MINNESOTA SOUTHERN", "state": "MN", "zip": "55009", "zip4": "", "countryCode": "US" }, "marketNumber": "0022300", "countrySubCode": "" } }, "eligibilityDetailHealthServices": [{ "policyNumber": "0911585", "productLine": "G", "productCode": "IW", "healthServiceEffectiveDates": { "start": "2018-02-08", "end": "9999-12-31" }, "cesGroupNumber": "0911585", "planVariationCode": "0001", "reportingCode": "0001", "systemDivision": "", "passportGroupNumber": "", "coverageLevel": "7", "sharedArrangementCode": "03", "obligorId": "01", "eligibilityStatusTypeCode": "A", "eligibilitySystemTypeCode": "01", "cancelReasonTypeCode": "", "coveragePaidThruDate": "9999-12-31", "coveragePaidThruReasonCode": "", "listBillTypeCode": "N", "billingSuffixCode": "P", "billingSubGroupNumber": "01001", "fundingType": "A", "stateOfIssue": "CA", "legacyBenefitPlanId": "", "legacyProductId": "", "consumerLegalEntity": "", "individualGroupTypeCode": "", "billIndicatorTypeCode": "" } ] } }, { "eligibility": { "consumerKeys": { "sourceCode": "CS", "familyId": "0012762421", "familyIdPartitionNumber": "00121", "xrefId": "0022658937", "xrefIdPartitionNumber": "00017", "legacySourceId": "09115850091603640302001" }, "demographics": { "personName": { "firstName": "DONNA", "middleInitial": "", "middleName": "", "lastName": "ROBINSON", "nameSuffix": "" }, "topsName": "DONNA", "gender": "F", "age": "21", "dependentNumber": "001", "topsLatestCancelDate": "", "systemDivision": "", "tobaccoUsageIndicator": "", "memberId": "", "survivingSpouseId": "", "hicNumber": "", "medicaidRecipientNumber": "", "memberAltId": "", "socialSecurityNumber": "000000000", "legacyPolicyNumber": "0911585", "claimEngineCode": "X", "legacyCustomerNumber": "0911585", "cesCustomerName": "SALESFORCE", "differentFamilyMemberAddressIndicator": "Y", "alternateIdAssignTypeCode": "S", "marketSegment": "USS", "integratedCardTypeCode": "H", "employeeStartDate": "0001-01-01", "workHours": "00000", "salaryTypeCode": "", "salaryAmount": "0.00", "retirementDate": "9999-12-31", "deceasedDate": "9999-12-31", "lateEnrollCode": "", "exSpouseTypeCode": "", "exSpouseSubscriberId": "", "healthCoverageTransferIndicator": "", "healthCoverageTransferEffectiveDates": { "start": "0001-01-01", "end": "9999-12-31" }, "atOccupationTypeCode": "", "rrDependentProofOfEligibilityDate": "", "cobraIndicator": "", "cobIndicator": "", "cobVerifyDate": "", "cobEffectiveDates": { "start": "", "end": "" }, "medicareExistsIndicator": "", "medicareTypeCode": "", "medicareIneligibleNotEnrolledCode": "", "medicareEntitlementTypeCode": "", "custodyCode": "", "familyLastUpdateTimestamp": "2018-08-27-10.35.20.150835", "migrationLegacySourceId": "", "migrationLegacyPolicyNumber": "", "camsLegacySourceId": "", "camsLegacyPolicyNumber": "", "consumerProvidedTaxIdNumber": "", "consumerProvidedTaxIdNumberStatusTypeCd": "", "eobSuppressionIndicator": "", "healthStatementSuppressionIndicator": "", "administrativeLetterSuppressionIndicator": "", "proofOfHealthCoverageSuppressionIndicator": "", "preferenceCodeDescription": "No preference selected", "memberLoyaltyYearsOfService": "", "memberLoyaltyAcknowledgementDate": "", "reportSegment": "USS", "healthProgramCode": "", "healthPlanCode": "", "familyId": "0012762421", "familyIdPartitionNumber": "00121", "sourceCode": "CS", "priorMemberId": "PMI", "dateOfBirth": "1999-01-01", "cdbRelationshipCode": "002", "legacySourceRelationshipCode": "02", "individualRelationshipCode": "CH", "topsSequenceNumber": "02", "topsOrigCoverageEffectiveDate": "2018-02-08", "primeDependentCode": "", "maritalStatus": "M", "employeeStatus": "A", "specialHandlerCode": "0", "phiIndicator": "", "qmscoIndicator": "", "primaryPhoneNumber": "", "alternatePhoneNumber": "", "mobilePhoneNumber": "", "organizationTypeCode": "", "permanentAddress": { "postalAddress": { "street1": "UHC MKT#1", "street2": "", "street3": "", "city": "MINNESOTA SOUTHERN", "state": "MN", "zip": "55009", "zip4": "", "countryCode": "US" }, "marketNumber": "0022300", "countrySubCode": "" }, "mailingAddress": { "postalAddress": { "street1": "UHC MKT#1", "street2": "", "street3": "", "city": "MINNESOTA SOUTHERN", "state": "MN", "zip": "55009", "zip4": "", "countryCode": "US" }, "marketNumber": "0022300", "countrySubCode": "" } }, "eligibilityDetailHealthServices": [{ "policyNumber": "0911585", "productLine": "G", "productCode": "IW", "healthServiceEffectiveDates": { "start": "2018-02-08", "end": "9999-12-31" }, "cesGroupNumber": "0911585", "planVariationCode": "0001", "reportingCode": "0001", "systemDivision": "", "passportGroupNumber": "", "coverageLevel": "7", "sharedArrangementCode": "03", "obligorId": "01", "eligibilityStatusTypeCode": "A", "eligibilitySystemTypeCode": "01", "cancelReasonTypeCode": "", "coveragePaidThruDate": "9999-12-31", "coveragePaidThruReasonCode": "", "listBillTypeCode": "N", "billingSuffixCode": "P", "billingSubGroupNumber": "01001", "fundingType": "A", "stateOfIssue": "CA", "legacyBenefitPlanId": "", "legacyProductId": "", "consumerLegalEntity": "", "individualGroupTypeCode": "", "billIndicatorTypeCode": "" } ] } } ] } ] } } } }';
            ADBLoyaltyResponseWrapper.parse(val);
        test.stopTest();
    }
    
    @isTest static void testLoyaltyResponseWrapper(){
        Test.startTest();
        ADBLoyaltyResponseWrapper lrw = new ADBLoyaltyResponseWrapper();
        ADBLoyaltyResponseWrapper.Vendors vd = new ADBLoyaltyResponseWrapper.Vendors();
        vd.coverageType = 'RX';
        vd.legacyPolicyNumber = '0710553';
        vd.legacyPlanVariation = null;
        vd.legacyReportingCode = null;
        vd.VendorEffectiveDates  = null;
        vd.vendorBenefitOptionTypeCode = null;
        vd.healthServiceProductCode  = null;
        
        ADBLoyaltyResponseWrapper.Pcps pcp = new ADBLoyaltyResponseWrapper.Pcps();
        pcp.coverageType = 'RX';
        pcp.mpin = null;
        pcp.pcpEffectiveDates = null;
        pcp.addressSequenceNumber = null;
        pcp.productCode = 'Q';
        pcp.marketType = '50';
        pcp.marketSite = null;
        pcp.ipa = null;   
        
        ADBLoyaltyResponseWrapper.VendorEffectiveDates ved = new ADBLoyaltyResponseWrapper.VendorEffectiveDates();
        ved.start = '2020-02-01';
        ved.end_Z = '9999-12-31';
        
        ADBLoyaltyResponseWrapper.Demographics demo = new ADBLoyaltyResponseWrapper.Demographics();
        demo.topsOrigCoverageEffectiveDate = '0001-01-01';
        demo.retirementDate = '9999-12-31';
        demo.cesCustomerName = 'TD AMERITRADE HOLDING CORP';
        demo.dependentNumber = '001';
        Test.stopTest();
    }
}